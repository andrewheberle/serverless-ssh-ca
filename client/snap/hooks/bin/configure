#!/bin/sh

# shellcheck source=client/snap/utilities/bin/management
. "$SNAP/utilities/bin/management"

printf 'issuer: %s\nclient_id: %s\nscopes: [%s]\nredirect_url: %s\nca_url: %s\n' \
    "$(issuer)" "$(client_id)" "$(scopes)" "$(redirect_url)" "$(ca_url)"

handle_config() {
    config="$(printf 'issuer: %s\nclient_id: %s\nscopes: [%s]\nredirect_url: %s\nca_url: %s\n' \
        "$(issuer)" "$(client_id)" "$(scopes)" "$(redirect_url)" "$(ca_url)")"

    if ca="$(get_trusted_ca)"; then
        config="$(printf '%s\ntrusted_ca: %s\n' "$config" "$ca")"
    fi

    echo "$config" > "$SNAP_DATA/config.yml"
}
handle_config