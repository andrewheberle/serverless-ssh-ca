#!/bin/sh
#
# This utility script is used as part of the Snap build of the client
#

get_value() {
    if [ $# -ne 1 ]; then
        return 1
    fi

    v="$(snapctl get "$1")"

    if [ -z "$v" ]; then
        return 1
    fi

    echo "$v"
}

has_config_set() {
    for v in "issuer" "client-id" "scopes" "redirect-url" "ca-url"; do
        if ! get_value "$v"; then
            return $?
        fi
    done
}

issuer() {
    get_value "issuer"
}

set_issuer() {
    snapctl set issuer="$1"
}

client_id() {
    get_value "client-id"
}

set_client_id() {
    snapctl set client-id="$1"
}

scopes() {
    if ! s="$(get_value "scopes")"; then
        return $?
    fi

    if [ -z "$s" ]; then
        printf '[ "openid", "email", "profile" ]'
    fi

    echo "$s" | awk -F',' '{printf "[ "; for(i=1; i<=NF; i++) {printf "\"%s\"", $i; if(i<NF) printf ", "} printf " ]\n"}'
}

set_scopes() {
    snapctl set scopes="$1"
}

redirect_url() {
    get_value "redirect-url"
}

set_redirect_url() {
    snapctl set redirect-url="$1"
}

ca_url() {
    get_value "ca-url"
}

set_ca_url() {
    snapctl set ca-url="$1"
}

trusted_ca() {
    get_value "trusted-ca"
}

set_trusted_ca() {
    snapctl set trusted-ca="$1"
}
